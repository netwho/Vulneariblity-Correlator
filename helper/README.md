# OpenVAS to Wireshark Vulnerability Correlator Helper

This directory contains utilities to convert OpenVAS vulnerability scan results into a format compatible with the Wireshark Vulnerability Correlator plugin.

## Overview

The Wireshark Vulnerability Correlator was originally designed to work with nmap Vulners XML output. This helper script extends support to **OpenVAS** vulnerability scanners by converting OpenVAS CSV exports into the XML format that the Wireshark plugin can process.

## Files in This Directory

### `openvas_csv_to_xml.py`
Python3 script that converts OpenVAS CSV exports to structured XML format.

### `sample-imput.csv`
Real-world example of OpenVAS CSV export from a lab environment showing the expected input format with all required columns.

### `sample-output.xml`
Example output XML generated by the conversion script, demonstrating the structured format used by the Wireshark plugin.

## OpenVAS CSV Format Requirements

The conversion script expects OpenVAS CSV exports with these columns:

| Column | Description | Required |
|--------|-------------|----------|
| `IP` | Target IP address | ‚úÖ Yes |
| `Port` | Service port number | ‚úÖ Yes |
| `Port Protocol` | Protocol (tcp/udp) | ‚úÖ Yes |
| `CVSS` | CVSS vulnerability score | ‚úÖ Yes |
| `NVT Name` | Vulnerability title/description | ‚úÖ Yes |
| `CVEs` | CVE identifiers (comma-separated) | ‚úÖ Yes |
| `Hostname` | Target hostname | ‚ùå Optional |
| `Summary` | Detailed vulnerability description | ‚ùå Optional |
| Other columns | Additional OpenVAS metadata | ‚ùå Ignored |

## Usage

### Basic Conversion

```bash
# Convert OpenVAS CSV to XML
python3 openvas_csv_to_xml.py input_scan.csv output_vulnerabilities.xml

# Example with provided sample files
python3 openvas_csv_to_xml.py sample-imput.csv converted-output.xml
```

### Integration with Wireshark Plugin

1. **Export OpenVAS scan to CSV**:
   - In OpenVAS, go to Scans ‚Üí Results ‚Üí Export
   - Select "CSV Results" format
   - Download the CSV file

2. **Convert to XML format**:
   ```bash
   python3 openvas_csv_to_xml.py openvas_export.csv vulnerabilities.xml
   ```

3. **Configure Wireshark plugin**:
   ```bash
   # Edit the plugin configuration
   nano ~/.local/lib/wireshark/plugins/vulners_correlator_final.lua
   
   # Update line 5 to point to converted XML:
   prefs.xml_path = "/path/to/vulnerabilities.xml"
   ```

4. **Launch Wireshark** with the "Vulnerability Analysis" profile and load your packet capture.

## XML Output Format

The script generates XML in this structure:

```xml
<?xml version='1.0' encoding='utf-8'?>
<report>
  <host ip="192.168.1.100">
    <service port="21" protocol="tcp" name="ProFTPD (mod_copy vulnerability)">
      <vulnerability cve="CVE-2015-3306" cvss="10.0">
        <title>ProFTPD mod_copy Unauthenticated Copying Of Files Via SITE CPFR/CPTO Vulnerability</title>
      </vulnerability>
    </service>
  </host>
</report>
```

### Key Features

- **IP-based grouping**: Vulnerabilities organized by target IP address
- **Service correlation**: Grouped by port and protocol with service identification
- **Service detection**: Automatic extraction of service names and versions (ProFTPD, Apache, MySQL, etc.)
- **CVE tracking**: Individual vulnerability entries with CVE identifiers
- **CVSS scoring**: Numeric severity scores for filtering
- **Descriptive titles**: Human-readable vulnerability descriptions from OpenVAS NVT names

## Data Processing Logic

### Input Filtering
- **Service-based**: Only processes entries with valid IP, Port, and Protocol
- **CVE-based**: Skips entries without CVE identifiers
- **Deduplication**: Removes duplicate CVE entries per service

### CVE Parsing
- Splits comma-separated CVE lists from OpenVAS
- Validates CVE format (starts with "CVE-")
- Preserves order and removes duplicates

### Service Identification
- **Intelligent extraction**: Analyzes NVT names, specific results, and product detection data
- **Version detection**: Extracts service versions (e.g., "jQuery 1.6.2", "Drupal 7.x")
- **Service mapping**: Maps port numbers and protocols to services
- **CPE parsing**: Processes Common Platform Enumeration data when available
- **Maintains protocol distinction**: TCP vs UDP
- **Sorts output numerically** by port for consistency

## Integration Benefits

### Compared to nmap Vulners
- **Comprehensive scanning**: OpenVAS provides broader vulnerability coverage
- **Enterprise features**: Better integration with enterprise vulnerability management
- **Detailed descriptions**: Richer vulnerability descriptions and metadata

### Wireshark Analysis Enhancement
- **Real-time correlation**: See vulnerabilities directly in packet analysis
- **Traffic validation**: Confirm vulnerable services are actually communicating
- **Incident response**: Quickly identify compromised vulnerable services
- **Compliance reporting**: Generate evidence of vulnerable service exposure

## Example Workflow

### 1. OpenVAS Scanning
```bash
# Run OpenVAS scan (via web interface or CLI)
# Export results as CSV with all columns
```

### 2. Conversion Process
```bash
# Convert the export
python3 openvas_csv_to_xml.py lab_scan_results.csv wireshark_vulns.xml

# Verify the output
head -20 wireshark_vulns.xml
```

### 3. Wireshark Integration
```bash
# Update plugin path
sed -i 's|prefs.xml_path = ".*"|prefs.xml_path = "/path/to/wireshark_vulns.xml"|' \
  ~/.local/lib/wireshark/plugins/vulners_correlator_final.lua

# Launch Wireshark with vulnerability data
wireshark -p "Vulnerability Analysis" capture.pcapng
```

### 4. Analysis with Display Filters
```bash
# High-severity vulnerabilities in traffic
vulners.cvss_high >= 7.0

# Specific CVE tracking
vulners.cve_id contains "CVE-2015-3306"

# Service-specific vulnerability analysis
vulners.service_desc contains "ProFTPD" and vulners.cvss_high >= 9.0
```

## Sample Analysis Results

Using the provided sample files, you can expect to see:

- **Host**: 172.28.184.18 (metasploitable3.netwho.lan)
- **High-risk services**: ProFTPD (CVE-2015-3306, CVSS 10.0), SSH with default credentials (CVSS 9.8)
- **Web vulnerabilities**: Drupal SQLi (CVE-2014-3704, CVSS 7.5)
- **SSL/TLS issues**: Weak cipher suites on port 631

## Troubleshooting

### Common Issues

#### CSV Format Problems
```bash
# Check CSV headers
head -1 openvas_export.csv

# Verify required columns are present
python3 -c "import csv; print(list(csv.DictReader(open('openvas_export.csv')))[:1])"
```

#### Encoding Issues
```bash
# Check file encoding
file openvas_export.csv

# Convert if necessary
iconv -f ISO-8859-1 -t UTF-8 openvas_export.csv > openvas_utf8.csv
```

#### XML Validation
```bash
# Validate generated XML
xmllint --noout output.xml && echo "XML is valid"

# Check XML structure
xmllint --format output.xml | head -20
```

## Script Requirements

- **Python 3.6+**
- **Standard libraries**: `csv`, `xml.etree.ElementTree`, `argparse`
- **Input**: OpenVAS CSV export with required columns
- **Output**: UTF-8 encoded XML compatible with Wireshark plugin

## Development Notes

### Extending the Script

To add support for additional OpenVAS fields:

1. **Modify column mapping** in `parse_cves()` function
2. **Update XML structure** in the main conversion loop
3. **Test with sample data** to ensure compatibility
4. **Update Wireshark plugin** to parse new fields

### Custom Field Mapping

The script currently maps:
- `NVT Name` ‚Üí `<title>` element
- `CVSS` ‚Üí `cvss` attribute
- `CVEs` ‚Üí `cve` attribute

Additional fields like `Summary` or `Solution` could be added as needed.

## Best Practices

1. **Regular Updates**: Re-run conversions when OpenVAS scan data changes
2. **File Management**: Use descriptive filenames for XML outputs
3. **Path Configuration**: Use absolute paths in plugin configuration
4. **Testing**: Always test with sample data before production use
5. **Backup**: Keep original CSV exports for reference

---

**Ready to correlate OpenVAS vulnerabilities with network traffic analysis!** üîçüõ°Ô∏è

*This helper extends the Wireshark Vulnerability Correlator's capabilities to enterprise-grade OpenVAS vulnerability scanning platforms.*